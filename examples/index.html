<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8"/>
  <title>Demo</title>
</head>

<body>
<div id="container">
  <!-- CONTENT HERE -->
</div>

<script src="seajs/sea.js"></script>
<script src="config.js"></script>
<script>
  var data = {
    name: 'notice-send',
    action: '/notice/send',

    // 表单数据
    //formData: JSON.parse(Storage.get(STORAGE_KEY)),

    // 数据相符校验，用于处理 formData 与 fields 匹配
    matchers: {
      // test: function(value, match) {
      // return value === match[0].value;
      // }
    },

    fields: [{
      name: 'receiver',
      label: '通知给',
      messages: {
        required: '请选择通知接收单位'
      },
      attrs: {
        placeholder: '请选择通知接收单位',
        required: 'required'
      }
    }, {
      name: 'title',
      label: '标题',
      attrs: {
        placeholder: '请输入标题，标题只能输入20个字哦~',
        required: 'required',
        maxlength: 20
      }
    }, {
      name: 'content',
      label: '正文',
      type: 'textarea',
      attrs: {
        placeholder: '请输入正文',
        required: 'required',
        maxlength: 2000
      }
    }, {
      name: 'img_url',
      label: '照片',
      attrs: {
        // placeholder: '',
        // required: 'required',
        maxcount: 9
      }
    }, {
      type: 'custom',
      value: '<div>已上传<span class="uploadedSum">2</span>/<span class="photoTotal">9</span></div>'
    }, {
      name: 'author',
      label: '发布人',
      type: 'select',
      // value: '三年二班',
      attrs: {
        // placeholder: '',
        required: 'required'
      },
      options: [{
        text: '三年二班 班主任',
        value: '三年二班 班主任'
      }, {
        text: '三年二班',
        value: '三年二班'
      }]
    }
    ],

    buttons: [{
      label: '发布',
      type: 'submit',
      role: 'publish'
    }, {
      type: 'custom',
      value: '<a>预览</a>'
    }],

    parentNode: '#container',

    // or initProps,
    setup: function () {
      /* var that = this;

       // 窗口重载，缓存数据
       window.onbeforeunload = function () {
       if (toBeCache) {
       Storage.set(STORAGE_KEY,
       JSON.stringify(that.get('formData').toJSON()));
       }
       };*/
    },

    // 表单 ajax 提交事件回调
    ajaxEvents: {
      'done': function (data) {
        if (+data.code) {
          alert(data.message);
          toBeCache = true;
        } else {
          // 保存成功，清除本地缓存
          Storage.remove(STORAGE_KEY);
          toBeCache = false;
        }
      },
      'fail': function (xhr, errorType, error) {
        console.log('fail', xhr, errorType, error);
        toBeCache = true;
      },
      'error': function (xhr, errorType, error) {
        console.log('error', xhr, errorType, error);
      },
      'timeout': function () {
        console.log('对不起，访问超时了');
      },
      'disconnect': function () {
        console.log('网络不给力，请检查网络');
      },
      'unauthorized': function () {
        console.log('未登录或会话过期');
      },
      'forbidden': function () {
        console.log('没有权限访问、操作');
      },
      'not-found': function () {
        console.log('对不起，没有找到您要的东西');
      },
      'method-not-allowed': function () {
        console.log('请求方法不对');
      }
    }

    // ajaxHandlers
  };
  seajs.use('index', function (Form) {
    new Form(data).render();
  });
</script>
</body>

</html>
